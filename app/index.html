<!doctype html>
<html class="no-js">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
        <title>song player</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
        <link rel="shortcut icon" href="/favicon.ico">
        <link rel="stylesheet" href="styles/styles.css">

    </head>
    <body>

    <!-- Add your site or application content here -->
    <div class="container"></div>

    <script type="text/template" id="tplPlayer">
	<section>
	    <figure id="audioplayer" itemprop="track" itemscope itemtype="http://schema.org/MusicRecording">
		    <figcaption>
			    <div>Track <span itemprop="name">{{name}}</span></div>
			    <div id="album">Album <span itemprop="inAlbum">album.name</span></div>
			    <div id="artist">Artist <span itemprop="byArtist">artist.name</span></div>
			    <div id="time">Time<span id="playbacktime">00:00</span></div>
		    </figcaption>
		    <meta itemprop="duration" content="PT2M29S">
		    <div id="fader">
			    <input type="range" min="0" max="1" step="any" value="1" id="volumeSlider" orient="vertical">
			    <button type="button" class="fa fa-volume-up" data-ctrl="btnVolume"></button>
		    </div>
		    <div id="playback">
			    <button type="button" data-ctrl="play" class="fa fa-play"></button>
			    <progress min="0" max="100" value="0" id="playhead"></progress>
		    </div>
		    <audio src="medias/01-rainbowblues.mp3" controls id="audiotrack" preload="auto" itemprop="audio"></audio>
	    </figure>
	</section>
    </script>
    <script src="components/jquery/dist/jquery.js"></script>
    <script src="components/underscore/underscore.js"></script>
    <script src="components/backbone/backbone.js"></script>
    <script>
	    'use strict';

	    _.templateSettings = {interpolate: /\{\{(.+?)\}\}/g };

	    var modPlayer = Backbone.Model.extend({
		    default: {
			    name: 'lalala',
			    artist: {
				    name: 'toto'
			    },
			    album: {
				    name: 'tralala'
			    }
		    },
		    initialize: function(){
			    console.log(this.default);
		    }
	    });

	    var playerView = Backbone.View.extend({
		    el: '.container',
		    template: _.template($('#tplPlayer').html()),
		    events: {
			    'click [data-ctrl="play"]': 'playerPlayPause'
		    },
		    initialize: function (options) {
			    console.log(options);
			    this.options = options || {};
		    },
		    render: function () {
			    this.$el.html(this.template(this.model.attributes));
			    return this;
		    },
		    playerPlayPause: function (e) {
			    console.log(this.$el.find('#audiotrack'));
			    var $audioTrack = this.$el.find('#audiotrack');
			    if ( $audioTrack.paused ) {
				    $(e.currentTarget).removeClass('fa-play').addClass('fa-pause');
				    $audioTrack.play();
			    } else {
				    $(e.currentTarget).removeClass('fa-pause').addClass('fa-play');
				    $audioTrack.pause();
			    }
		    }
	    });
	    // faire le module sous forme de plugin jq et mettre les attributs dont on a besion dans des data-*

	    var confPlayer = new modPlayer();
	    var player = new playerView({model:confPlayer});
	    player.render();

	    //var audioPlayer = document.getElementById('audioplayer'),
	    // audioTrack = document.getElementById('audiotrack'),
	    // playButton = angular.element(''),
	    // fader = document.getElementById('fader'),
	    // playback = document.getElementById('playback'),
	    // playbackTime = document.getElementById('playbacktime'),
	    // playhead = document.getElementById('playhead'),volumeSlider = document.getElementById('volumeSlider'),duration = audioTrack.duration,isMute = false,restorValue,_setText = function (el, text) {el.text(text);};
	    //$scope.player = function() {};
	    // Fonction de d'activation/desactivation du volume
	    //$scope.muter = function () {if ( audioTrack.volume === 0 ) {audioTrack.volume = restorValue;volumeSlider.value = restorValue;} else {restorValue = volumeSlider.value;audioTrack.volume = 0;volumeSlider.value = 0;}};
	    //$scope.volumizer = function () {if ( audioTrack.volume === 0 ) {_setText(muteButton, 'Unmute');} else {_setText(muteButton, 'Mute');}};
	    //$scope.finish = function () {audioTrack.currentTime = 0; _setText(playButton, 'Play');};
	    //$scope.updatePlayhead = function () {playhead.value = audioTrack.currentTime;var s = parseInt(audioTrack.currentTime % 60);var m = parseInt((audioTrack.currentTime / 60) % 60);s = (s >= 10) ? s : '0' + s;m = (m >= 10) ? m : '0' + m;playbacktime.innerHTML = m + ':' + s ;};
	    //songPlayer.prototype = {
	    // self.volumeSlider.addEventListener('input', function(){self.audioTrack.volume = self.volumeSlider.value;}, false);
	    // self.audioTrack.addEventListener('volumechange', self.volumizer, false);
	    // self.audioTrack.addEventListener('ended', self.finish, false);
	    // self.audioTrack.addEventListener('playing', function(){self.playhead.max = self.audioTrack.duration;}, false);
	    // self.audioTrack.addEventListener('timeupdate', self.updatePlayhead, false);},
	    //audioTrack.removeAttribute('controls');},
    </script>

    </body>
</html>
